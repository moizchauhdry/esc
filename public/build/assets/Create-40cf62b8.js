import{p as g,J as N,v as U,m as I,f as _,a as l,w as r,F as w,o as p,d as f,b as t,i as x,z as v,u as a,y as A,t as q,g as O,n as Y,e as B}from"./app-b9ce0331.js";import{_ as L,a as j}from"./SecondaryButton-5f79f9ed.js";import{_ as b}from"./SuccessButton-a2bae6d0.js";import{_ as z}from"./InputLabel-94bb4420.js";import{_ as K}from"./InputError-aa9b4c18.js";import{h as G}from"./moment-a9aaa855.js";const J=t("i",{class:"bx bx-plus"},null,-1),P={class:"p-6"},R={class:"text-lg font-medium text-gray-900"},H=t("span",null,"Add Expense",-1),Q=t("i",{class:"bx bx-plus text-lg"},null,-1),W=t("hr",null,null,-1),X={class:"mt-6"},Z={class:"row g-2"},tt={class:"col-md-4"},et={class:"row"},st={class:"col-md-12"},ot={key:0,class:"mt-3"},nt=t("thead",null,[t("tr",null,[t("td",{class:"text-left"},"DESCRIPTION"),t("td",{class:"text-left"},"AMOUNT"),t("td",{class:"text-left"})])],-1),at={class:"text-left",style:{width:"50%"}},lt=["onUpdate:modelValue"],it={class:"total",style:{width:"15%"}},rt=["onUpdate:modelValue","onKeyup"],ct={class:"no",style:{width:"5%"}},dt=["onClick"],ut=t("i",{class:"bx bxs-trash"},null,-1),mt=[ut],_t=t("th",{class:"text-right"},"TOTAL",-1),pt={class:"text-right"},ft=t("th",null,null,-1),ht={class:"mt-6 flex justify-end"},Dt={__name:"Create",props:{filter:Object},setup(xt,{expose:C}){const c=g(!1),d=g(!1),y=N().props.filter,e=U({items:[{description:"",amount:"",qty:1,total:0}],expense_at:"",expense_id:""}),D=()=>{c.value=!0,d.value=!1,e.total=0},k=()=>{e.post(route("expense.store"),{preserveScroll:!0,onSuccess:s=>{u()},onError:s=>{console.log(s)},onFinish:()=>{}})},$=s=>{s&&(c.value=!0,d.value=!0,e.expense_id=s.id,e.expense_at=T(s.expense_at),axios.get(`/expenses/fetch/expense-items/${s.id}`).then(({data:n})=>{e.items=[],n.expense_items.forEach((o,m)=>{e.items[m]={description:o.description,amount:o.amount,qty:1,total:o.amount}}),e.total=n.expense.total_amount}))},S=()=>{e.post(route("expense.update"),{preserveScroll:!0,onSuccess:()=>u(),onError:()=>error(),onFinish:()=>{}})},u=()=>{c.value=!1,e.reset()},V=()=>{e.items.push({year:y.year,month:y.month,description:"",amount:"",qty:1,total:0})},E=s=>{e.items.splice(s,1),h()},h=()=>{e.subtotal=0,e.items.forEach(s=>{e.subtotal+=parseFloat(s.total)}),e.total=e.subtotal},F=s=>{const n=e.items[s],o=n.qty*n.amount;n.total=o,h()},M=s=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s),T=s=>G(s).format("YYYY-MM-DD");return C({edit:s=>$(s)}),I(()=>{d&&h()}),(s,n)=>(p(),_(w,null,[l(b,{onClick:D,type:"button",class:"mx-1"},{default:r(()=>[J,f(" Add Expense")]),_:1}),l(L,{show:c.value,onClose:u},{default:r(()=>[t("form",{onSubmit:n[2]||(n[2]=B(o=>d.value?S():k(),["prevent"]))},[t("div",P,[t("h2",R,[H,l(b,{type:"button",class:"float-right",onClick:n[0]||(n[0]=o=>V())},{default:r(()=>[Q,f("Add Item")]),_:1})]),W,t("div",X,[t("div",Z,[t("div",tt,[l(z,{for:"",value:"Month",class:"mb-1"}),x(t("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=o=>a(e).expense_at=o),class:"form-control"},null,512),[[v,a(e).expense_at]]),l(K,{message:a(e).errors.expense_at},null,8,["message"])])]),t("div",et,[t("div",st,[a(e).items.length>0?(p(),_("table",ot,[nt,t("tbody",null,[(p(!0),_(w,null,A(a(e).items,(o,m)=>(p(),_("tr",{key:o.id},[t("td",at,[x(t("input",{type:"text",class:"form-control","onUpdate:modelValue":i=>o.description=i},null,8,lt),[[v,o.description]])]),t("td",it,[x(t("input",{type:"number",class:"form-control","onUpdate:modelValue":i=>o.amount=i,onKeyup:i=>F(m)},null,40,rt),[[v,o.amount]])]),t("td",ct,[t("button",{type:"button",onClick:i=>E(m),class:"ms-1 text-danger text-lg"},mt,8,dt)])]))),128))]),t("tfoot",null,[t("tr",null,[_t,t("th",pt,q(M(a(e).total)),1),ft])])])):O("",!0)])])]),t("div",ht,[l(j,{onClick:u},{default:r(()=>[f(" Cancel ")]),_:1}),l(b,{class:Y(["ml-3",{"opacity-25":a(e).processing}]),disabled:a(e).processing},{default:r(()=>[f(" Save ")]),_:1},8,["class","disabled"])])])],32)]),_:1},8,["show"])],64))}};export{Dt as default};
